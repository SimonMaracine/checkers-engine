Implement the improved protocol. Don't change anything else.
